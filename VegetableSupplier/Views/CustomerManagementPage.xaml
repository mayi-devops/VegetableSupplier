<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VegetableSupplier.Views.CustomerManagementPage"
             Title="Customers">

    <Grid RowDefinitions="Auto,*" Padding="20">
        <!-- Search and Filter -->
        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="15" RowSpacing="15">
            <SearchBar Grid.ColumnSpan="2"
                      Placeholder="Search customers..."
                      Text="{Binding SearchQuery}"/>

            <Picker Grid.Row="1"
                    ItemsSource="{Binding CustomerTypes}"
                    SelectedItem="{Binding SelectedType}"
                    Title="Customer Type"/>

            <ActivityIndicator Grid.Row="1"
                             Grid.Column="1"
                             IsVisible="{Binding IsLoading}"
                             IsRunning="{Binding IsLoading}"/>
        </Grid>

        <!-- Customers List -->
        <RefreshView Grid.Row="1"
                    Command="{Binding LoadCustomersCommand}"
                    IsRefreshing="{Binding IsLoading}">
            <CollectionView ItemsSource="{Binding Customers}"
                          EmptyView="No customers found">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.LeftItems>
                                <SwipeItems>
                                    <SwipeItem Text="Edit"
                                              BackgroundColor="{StaticResource Primary}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type views:CustomerManagementPage}}, Path=BindingContext.EditCustomerCommand}"
                                              CommandParameter="{Binding .}"/>
                                    <SwipeItem Text="Orders"
                                              BackgroundColor="{StaticResource Secondary}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type views:CustomerManagementPage}}, Path=BindingContext.ViewOrdersCommand}"
                                              CommandParameter="{Binding .}"/>
                                </SwipeItems>
                            </SwipeView.LeftItems>

                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Pricing"
                                              BackgroundColor="{StaticResource Tertiary}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type views:CustomerManagementPage}}, Path=BindingContext.SetSpecialPricingCommand}"
                                              CommandParameter="{Binding .}"/>
                                    <SwipeItem Text="New Order"
                                              BackgroundColor="{StaticResource Primary}"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type views:CustomerManagementPage}}, Path=BindingContext.CreateOrderCommand}"
                                              CommandParameter="{Binding .}"/>
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <Frame Margin="0,5" Padding="15">
                                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
                                    <Label Text="{Binding Name}"
                                           FontAttributes="Bold"/>
                                    
                                    <Label Grid.Row="1"
                                           Text="{Binding CustomerType}"
                                           TextColor="{StaticResource Primary}"/>
                                    
                                    <Label Grid.Row="2"
                                           Text="{Binding PhoneNumber}"
                                           TextColor="{StaticResource Gray500}"/>
                                    
                                    <StackLayout Grid.Column="1"
                                                Grid.RowSpan="3"
                                                HorizontalOptions="End">
                                        <Label Text="Credit Balance"
                                               TextColor="{StaticResource Gray500}"
                                               HorizontalOptions="End"/>
                                        <Label Text="{Binding CurrentCredit, StringFormat='₹{0:N0}'}"
                                               FontAttributes="Bold"
                                               HorizontalOptions="End"/>
                                        <Label Text="{Binding CreditLimit, StringFormat='Limit: ₹{0:N0}'}"
                                               TextColor="{StaticResource Gray500}"
                                               HorizontalOptions="End"/>
                                    </StackLayout>
                                </Grid>
                            </Frame>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Add Customer Button -->
        <Button Grid.Row="1"
                Text="+"
                FontSize="32"
                WidthRequest="60"
                HeightRequest="60"
                CornerRadius="30"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="20"
                Command="{Binding AddCustomerCommand}"/>
    </Grid>
</ContentPage>